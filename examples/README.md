# ERNC Protocol Examples v3.0

æœ¬ç›®å½•åŒ…å«äº†é€‚é…æ–°ç‰ˆERNC_praram.protoçš„å®Œæ•´ç¤ºä¾‹ç¨‹åºï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ›´æ–°åçš„protocolæ¨¡å—ã€‚

## ğŸ¯ **æ–°ç‰ˆæœ¬ç‰¹æ€§**

### âœ¨ **æ ¸å¿ƒæ›´æ–°**
- **18ç§æ–°æ¶ˆæ¯ç±»å‹**: ä»åŸºç¡€çš„3ç§æ‰©å±•ä¸ºå®Œæ•´çš„18ç§æ¶ˆæ¯ç±»å‹
- **å®Œæ•´ProtoIDæ˜ å°„**: æ”¯æŒProtoID 0-158çš„å®Œæ•´æ˜ å°„å…³ç³»
- **å±‚æ¬¡åŒ–å‚æ•°ç»“æ„**: æ”¯æŒå¤æ‚çš„åµŒå¥—å‚æ•°é…ç½®
- **è½¦è¾†çŠ¶æ€é›†æˆ**: æ–°å¢å®Œæ•´çš„è½¦è¾†çŠ¶æ€ç›‘æ§åŠŸèƒ½
- **é€šé“é…ç½®ç®¡ç†**: æ”¯æŒå¤šé€šé“éŸ³é¢‘å¤„ç†é…ç½®

### ğŸ“‹ **æ”¯æŒçš„æ¶ˆæ¯ç±»å‹**
| æ¶ˆæ¯ç±»å‹ | ProtoID | åŠŸèƒ½æè¿° |
|---------|---------|----------|
| `CHANNEL_NUMBER` | 0 | é€šé“æ•°é‡é…ç½® |
| `CHANNEL_AMPLITUDE` | 25 | é€šé“å¹…å€¼é…ç½® |
| `ANC_SWITCH` | 151 | ANC/ENC/RNCå¼€å…³æ§åˆ¶ |
| `VEHICLE_STATE` | 138 | è½¦è¾†çŠ¶æ€ç›‘æ§ |
| `ALPHA_PARAMS` | 158 | RNCæ­¥é•¿å‚æ•° |
| `ORDER2_PARAMS` | 78 | ENC 2é˜¶å‚æ•° |
| ...æ›´å¤š | 0-158 | å®Œæ•´çš„ERNCåŠŸèƒ½æ”¯æŒ |

---

## ğŸ“ **ç¤ºä¾‹ç¨‹åºç›®å½•**

### ğŸ”§ **C++ç¤ºä¾‹ç¨‹åº**

#### 1. **basic_usage_example.cpp** - åŸºç¡€ä½¿ç”¨ç¤ºä¾‹
```bash
./basic_example
```
**ä¸»è¦æ¼”ç¤ºåŠŸèƒ½:**
- âœ… ANC/ENC/RNCå¼€å…³æ§åˆ¶ï¼ˆä½¿ç”¨æ–°çš„å‚æ•°ç»“æ„ï¼‰
- âœ… è½¦è¾†çŠ¶æ€å‚æ•°å‘é€ï¼ˆé€Ÿåº¦ã€å‘åŠ¨æœºè½¬é€Ÿï¼‰
- âœ… é€šé“é…ç½®å‚æ•°è®¾ç½®ï¼ˆå‚è€ƒé€šé“ã€è¯¯å·®é€šé“ï¼‰
- âœ… RNCæ­¥é•¿å‚æ•°ç»„å‘é€
- âœ… æ–°æ”¯æŒçš„18ç§æ¶ˆæ¯ç±»å‹å±•ç¤º

#### 2. **advanced_usage_example.cpp** - é«˜çº§åŠŸèƒ½ç¤ºä¾‹
```bash
./advanced_example
```
**ä¸»è¦æ¼”ç¤ºåŠŸèƒ½:**
- âœ… æ–°æ¶ˆæ¯ç±»å‹ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯
- âœ… åè®®é€‚é…å™¨çŠ¶æ€ç›‘æ§
- âœ… å±‚æ¬¡åŒ–å‚æ•°ç»“æ„åºåˆ—åŒ–/ååºåˆ—åŒ–
- âœ… ERNCåè®®ç‰ˆæœ¬ç®¡ç†
- âœ… å‚æ•°æ˜ å°„é…ç½®åŠ è½½

#### 3. **usage_example.cpp** - MockTransportä½¿ç”¨ç¤ºä¾‹
```bash
./usage_example
```
**ä¸»è¦æ¼”ç¤ºåŠŸèƒ½:**
- âœ… Mockä¼ è¾“å±‚å®ç°
- âœ… æ–°å‚æ•°ç»“æ„çš„å‘é€å’ŒéªŒè¯
- âœ… åè®®é€‚é…å™¨ç»Ÿè®¡ä¿¡æ¯
- âœ… æ¶ˆæ¯ç±»å‹è¦†ç›–ç‡ç»Ÿè®¡

#### 4. **dependency_injection_example.cpp** - ä¾èµ–æ³¨å…¥æ¶æ„ç¤ºä¾‹
```bash
./di_example
```
**ä¸»è¦æ¼”ç¤ºåŠŸèƒ½:**
- âœ… ä¼ è¾“å±‚åŠ¨æ€åˆ‡æ¢
- âœ… æ–°å‚æ•°è·¯å¾„éªŒè¯
- âœ… è¿è¡Œæ—¶å‚æ•°æ”¯æŒæ£€æŸ¥
- âœ… èµ„æºç®¡ç†å’Œæ¸…ç†

#### 5. **producer_consumer_integration_example.cpp** - ç”Ÿäº§è€…æ¶ˆè´¹è€…é›†æˆç¤ºä¾‹
```bash
./producer_consumer_example
```
**ä¸»è¦æ¼”ç¤ºåŠŸèƒ½:**
- âœ… ERNCåè®®æ¶ˆæ¯ç”Ÿæˆï¼ˆJSONæ ¼å¼ï¼‰
- âœ… å¤šç§æ¶ˆæ¯ç±»å‹çš„æ•°æ®æµå¤„ç†
- âœ… è½¦è¾†çŠ¶æ€å’Œæ§åˆ¶æ¶ˆæ¯çš„å®æ—¶å¤„ç†
- âœ… æ€§èƒ½ç›‘æ§å’Œç»Ÿè®¡

#### 6. **protocol_integration_test.cpp** - å®Œæ•´é›†æˆæµ‹è¯•
```bash
./integration_test
```
**ä¸»è¦æ¼”ç¤ºåŠŸèƒ½:**
- âœ… æ‰€æœ‰18ç§æ¶ˆæ¯ç±»å‹çš„åŠŸèƒ½éªŒè¯
- âœ… å‚æ•°æ˜ å°„å®Œæ•´æ€§æµ‹è¯•
- âœ… åè®®é€‚é…å™¨é›†æˆæµ‹è¯•
- âœ… æ¶ˆæ¯åºåˆ—åŒ–å™¨æµ‹è¯•

### ğŸ¨ **QMLç•Œé¢ç¤ºä¾‹**

#### 1. **protocol_usage_example.qml** - QMLåè®®æ§åˆ¶ç•Œé¢
**ä¸»è¦ç‰¹æ€§:**
- âœ… å¯è§†åŒ–çš„ANC/ENC/RNCå¼€å…³æ§åˆ¶
- âœ… è½¦è¾†çŠ¶æ€å®æ—¶ç›‘æ§ç•Œé¢
- âœ… é€šé“é…ç½®å¯è§†åŒ–è®¾ç½®
- âœ… RNCå‚æ•°è°ƒèŠ‚ç•Œé¢
- âœ… ENC 2é˜¶å‚æ•°é…ç½®

#### 2. **dependency_injection_example.qml** - QMLä¾èµ–æ³¨å…¥æ¶æ„ç•Œé¢
**ä¸»è¦ç‰¹æ€§:**
- âœ… ä¼ è¾“å±‚ç®¡ç†ç•Œé¢
- âœ… åè®®é€‚é…å™¨çŠ¶æ€æ˜¾ç¤º
- âœ… æ–°å‚æ•°ç»“æ„æ¼”ç¤º
- âœ… è¿è¡Œæ—¶åˆ‡æ¢åŠŸèƒ½å±•ç¤º

---

## ğŸš€ **æ„å»ºå’Œè¿è¡Œ**

### ğŸ“‹ **å‰ç½®è¦æ±‚**
```bash
- Qt 6.0+
- CMake 3.16+
- C++17 æ”¯æŒçš„ç¼–è¯‘å™¨
- nanopb library
```

### ğŸ”¨ **æ„å»ºæ­¥éª¤**
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
mkdir build && cd build
cmake ..
make -j4

# æ„å»ºç¤ºä¾‹ç¨‹åº
cd protocol/examples
make -j4
```

### â–¶ï¸ **è¿è¡Œç¤ºä¾‹**
```bash
# C++ç¤ºä¾‹ç¨‹åº
./basic_example           # åŸºç¡€åŠŸèƒ½æ¼”ç¤º
./advanced_example        # é«˜çº§åŠŸèƒ½æ¼”ç¤º  
./usage_example           # MockTransportæ¼”ç¤º
./di_example              # ä¾èµ–æ³¨å…¥æ¼”ç¤º
./producer_consumer_example # ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¼”ç¤º
./integration_test        # å®Œæ•´é›†æˆæµ‹è¯•

# QMLç¤ºä¾‹ï¼ˆå¦‚æœæ„å»ºäº†Qt Quickæ”¯æŒï¼‰
./qml_example             # QMLç•Œé¢æ¼”ç¤º
./qml_di_example          # QMLä¾èµ–æ³¨å…¥æ¼”ç¤º
```

---

## ğŸ’¡ **æ–°å‚æ•°ç»“æ„ä½¿ç”¨ç¤ºä¾‹**

### ğŸ”„ **ANC/ENC/RNCå¼€å…³æ§åˆ¶**
```cpp
// æ—§ç‰ˆæœ¬ï¼ˆç®€å•å¸ƒå°”å€¼ï¼‰
adapter->sendParameterUpdate("anc.enabled", true);

// æ–°ç‰ˆæœ¬ï¼ˆå®Œæ•´çš„å¼€å…³ç»“æ„ï¼‰
QVariantMap ancParams;
ancParams["anc_off"] = false;  // å¼€å¯ANC
ancParams["enc_off"] = true;   // å…³é—­ENC  
ancParams["rnc_off"] = false;  // å¼€å¯RNC
adapter->sendParameterUpdate("anc.enabled", ancParams);
```

### ğŸš— **è½¦è¾†çŠ¶æ€å‚æ•°**
```cpp
QVariantMap vehicleParams;
vehicleParams["speed"] = 80;              // è½¦é€Ÿ80km/h
vehicleParams["engine_speed"] = 2000;     // å‘åŠ¨æœºè½¬é€Ÿ2000rpm
adapter->sendParameterUpdate("vehicle.speed", vehicleParams);
```

### ğŸ“» **é€šé“é…ç½®å‚æ•°**
```cpp
QVariantMap channelParams;
channelParams["refer_num"] = 4;           // 4ä¸ªå‚è€ƒé€šé“
channelParams["error_num"] = 8;           // 8ä¸ªè¯¯å·®é€šé“
adapter->sendParameterUpdate("channel.refer_num", channelParams);
```

### âš™ï¸ **RNCå‚æ•°ç»„**
```cpp
QVariantMap rncParams;
rncParams["alpha1"] = 100;
rncParams["alpha2"] = 150;  
rncParams["alpha3"] = 200;
adapter->sendParameterUpdate("rnc.alpha1", rncParams);
```

---

## ğŸ¯ **æµ‹è¯•ç”¨ä¾‹**

### âœ… **è‡ªåŠ¨åŒ–æµ‹è¯•**
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
ctest

# è¿è¡Œç‰¹å®šæµ‹è¯•
ctest -R basic_example_test
ctest -R integration_test
```

### ğŸ“Š **æ€§èƒ½åŸºå‡†æµ‹è¯•**
```bash
# æ¶ˆæ¯å¤„ç†æ€§èƒ½æµ‹è¯•
./integration_test --benchmark

# å†…å­˜ä½¿ç”¨åˆ†æ
valgrind --tool=memcheck ./basic_example

# ç½‘ç»œä¼ è¾“æµ‹è¯•
./producer_consumer_example --network-test
```

---

## ğŸ” **æ•…éšœæ’é™¤**

### âš ï¸ **å¸¸è§é—®é¢˜**

1. **å‚æ•°æ˜ å°„æ–‡ä»¶æœªæ‰¾åˆ°**
   ```
   è§£å†³: ç¡®ä¿parameter_mapping.jsonåœ¨æ­£ç¡®è·¯å¾„
   é»˜è®¤è·¯å¾„: protocol/config/parameter_mapping.json
   ```

2. **æ¶ˆæ¯ç±»å‹ä¸æ”¯æŒ**
   ```
   æ£€æŸ¥: ç¡®è®¤ä½¿ç”¨çš„æ¶ˆæ¯ç±»å‹åœ¨18ç§æ”¯æŒç±»å‹èŒƒå›´å†…
   ProtoIDèŒƒå›´: 0-158
   ```

3. **å‚æ•°ç»“æ„é”™è¯¯**
   ```
   éªŒè¯: ä½¿ç”¨æ–°çš„å±‚æ¬¡åŒ–å‚æ•°ç»“æ„
   ç¤ºä¾‹: QVariantMapè€Œä¸æ˜¯ç®€å•å€¼
   ```

4. **ç¼–è¯‘é”™è¯¯**
   ```
   ç¡®è®¤: Qt 6.0+, C++17, nanopbåº“æ­£ç¡®å®‰è£…
   æ£€æŸ¥: CMakeLists.txtä¸­çš„ä¾èµ–é¡¹
   ```

---

## ğŸ“ **æŠ€æœ¯æ”¯æŒ**

### ğŸ“‹ **ç‰ˆæœ¬ä¿¡æ¯**
- **ERNC Protocol**: v3.0.0
- **æ”¯æŒçš„æ¶ˆæ¯ç±»å‹**: 18ç§
- **ProtoIDèŒƒå›´**: 0-158
- **å‚æ•°æ•°é‡**: 70+ hierarchical parameters

### ğŸ”— **ç›¸å…³æ–‡æ¡£**
- `protocol/messages/ERNC_praram.proto` - Protocol Bufferså®šä¹‰
- `protocol/config/parameter_mapping.json` - å‚æ•°æ˜ å°„é…ç½®
- `protocol/core/message_types.h` - æ¶ˆæ¯ç±»å‹å®šä¹‰

### ğŸ› **é—®é¢˜æŠ¥å‘Š**
å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. ä½¿ç”¨çš„ç¤ºä¾‹ç¨‹åºåç§°
2. é”™è¯¯ä¿¡æ¯å’Œæ—¥å¿—è¾“å‡º
3. æ“ä½œç³»ç»Ÿå’ŒQtç‰ˆæœ¬
4. å‚æ•°é…ç½®å†…å®¹

---

**ğŸ‰ æ­å–œï¼æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨åŠŸèƒ½å®Œæ•´çš„ERNC Protocol v3.0ç³»ç»Ÿäº†ï¼**
